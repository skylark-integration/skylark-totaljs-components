<style>.ui-keyvalue-label{margin-bottom:5px;font-size:12px}.ui-keyvalue-label .fa{margin-right:5px}.ui-keyvalue-items > div:first-child{border-radius:2px 2px 0 0}.ui-keyvalue-item{height:32px;background-color:white;border-radius:2px;border:1px solid #E0E0E0;border-bottom:0}.ui-keyvalue-item-remove{float:right;width:32px;height:32px;border-left:1px solid #E0E0E0;text-align:center;color:#DA4453;font-size:14px}.ui-keyvalue-item-key{height:31px;padding:3px 0 4px;float:left;width:200px;border-right:1px solid #E0E0E0;font-weight:bold}.ui-keyvalue-item-value{padding:3px 0 0;margin:0 32px 0 202px}.ui-keyvalue-item .fa{cursor:pointer;display:block;padding:8px 0 0}.ui-keyvalue-item .fa:active{margin-top:1px}.ui-keyvalue-item input{width:100%;background-color:transparent;border:0;padding:2px 10px 0;outline:0;font-size:14px;color:black}.ui-keyvalue-base .ui-keyvalue-item-remove{display:none}.ui-keyvalue-base{border-radius:0 0 2px 2px;border-bottom:1px solid #E0E0E0}.ui-keyvalue.ui-disabled input{color:gray;cursor:not-allowed}.ui-keyvalue.ui-disabled .fa{display:none}.empty .ui-keyvalue-base{border-radius:2px}</style>
<script>COMPONENT('keyvalue','maxlength:100',function(self,config){var container,content=null,cempty='empty',skip=false,empty={};self.nocompile&&self.nocompile();self.template=Tangular.compile('<div class="ui-keyvalue-item"><div class="ui-keyvalue-item-remove"><i class="fa fa-times"></i></div><div class="ui-keyvalue-item-key"><input type="text" name="key" maxlength="{{ max}}"{{ if disabled}} disabled="disabled"{{ fi}} placeholder="{{ placeholder_key}}" value="{{ key}}" /></div><div class="ui-keyvalue-item-value"><input type="text" maxlength="{{ max}}" placeholder="{{ placeholder_value}}" value="{{ value}}" /></div></div>');self.binder=function(type,value){return value};self.configure=function(key,value,init,prev){if(init)return;var redraw=false;switch(key){case'disabled':self.tclass('ui-disabled',value);self.find('input').prop('disabled',value);empty.disabled=value;break;case'maxlength':self.find('input').prop('maxlength',value);break;case'placeholderkey':self.find('input[name="key"]').prop('placeholder',value);break;case'placeholdervalue':self.find('input[name="value"]').prop('placeholder',value);break;case'icon':if(value&&prev)self.find('i').rclass('fa').aclass('fa fa-'+value);else redraw=true;break;case'label':redraw=true;break}if(redraw){self.redraw();self.refresh()}};self.redraw=function(){var icon=config.icon,label=config.label||content;if(icon)icon='<i class="fa fa-{0}"></i>'.format(icon);empty.value='';self.html((label?'<div class="ui-keyvalue-label">{1}{0}:</div>'.format(label,icon):'')+'<div class="ui-keyvalue-items"></div>'+self.template(empty).replace('-item"','-item ui-keyvalue-base"'));container=self.find('.ui-keyvalue-items')};self.make=function(){empty.max=config.maxlength;empty.placeholder_key=config.placeholderkey;empty.placeholder_value=config.placeholdervalue;empty.value='';empty.disabled=config.disabled;content=self.html();self.aclass('ui-keyvalue');self.disabled&&self.aclass('ui-disabled');self.redraw();self.event('click','.fa-times',function(){if(config.disabled)return;var el=$(this);var parent=el.closest('.ui-keyvalue-item');var inputs=parent.find('input');var obj=self.get();!obj&&(obj={});var key=inputs[0].value;parent.remove();delete obj[key];SET(self.path,obj,2);self.change(true)});self.event('change keypress','input',function(e){if(config.disabled||(e.type!=='change'&&e.which!==13))return;var el=$(this);var inputs=el.closest('.ui-keyvalue-item').find('input');var key=self.binder('key',inputs[0].value);var value=self.binder('value',inputs.get(1).value);if(!key||!value)return;var base=el.closest('.ui-keyvalue-base').length>0;if(base&&e.type==='change')return;if(base){var tmp=self.get();!tmp&&(tmp={});tmp[key]=value;self.set(tmp);self.change(true);inputs.val('');inputs.eq(0).focus();return}var keyvalue={},k;container.find('input').each(function(){if(this.name==='key'){k=this.value.trim()}else if(k){keyvalue[k]=this.value.trim();k=''}});skip=true;SET(self.path,keyvalue,2);self.change(true)})};self.setter=function(value){if(skip){skip=false;return}if(!value){container.empty();self.aclass(cempty);return}var builder=[];Object.keys(value).forEach(function(key){empty.key=key;empty.value=value[key];builder.push(self.template(empty))});self.tclass(cempty,builder.length===0);container.empty().append(builder.join(''))}});</script>